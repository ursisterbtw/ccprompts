#!/usr/bin/env python3

def generate_bar_chart(value, width):
    filled = min(width, int(round(value * width / 6.0)))

def generate_sparkline(data):
    # Convert data to a simple sparkline
    bars = 'â–â–‚â–ƒâ–„â–…â–†â–‡â–ˆ'
    max_val = max(data) if data else 1
    min_val = min(data) if data else 0
    delta = max_val - min_val if max_val > min_val else 1
    
    sparkline = ''
    for val in data:
        index = int((val - min_val) / delta * (len(bars) - 1))
        sparkline += bars[min(index, len(bars) - 1)]
    return sparkline

def main():
    # Example data structure - in a real workflow, this would come from your workflow
    data = {
        'workflows': {
            'test': {'before': 5.5, 'after': 4.2, 'trend': 'â†“'},
            'build': {'before': 8.1, 'after': 6.7, 'trend': 'â†“'},
            'deploy': {'before': 3.2, 'after': 3.1, 'trend': 'â†’'}
        },
        'baseline': [5.5, 4.8, 5.2, 4.9, 5.1],
        'current': [4.2, 4.0, 4.1, 4.0, 4.2]
    }

    report = """# ğŸ“Š Performance Report

### Performance Sparklines
**Before PR:** {before_sparkline} (avg: {before_avg:.1f}m)
**After PR:**  {after_sparkline} (avg: {after_avg:.1f}m)

### Workflow Performance Breakdown
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Workflow    â”‚ Before   â”‚ After    â”‚ Trend â”‚ Performance             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤""".format(
        before_sparkline=generate_sparkline(data['baseline']),
        before_avg=sum(data['baseline'])/len(data['baseline']),
        after_sparkline=generate_sparkline(data['current']),
        after_avg=sum(data['current'])/len(data['current'])
    )

    for name, metrics in data['workflows'].items():
        change = ((metrics['before'] - metrics['after']) / metrics['before']) * 100
        bar = generate_bar_chart(metrics['after'], 6)
        report += f"\nâ”‚ {name:<11} â”‚ {metrics['before']:>6.1f}m â”‚ {metrics['after']:>6.1f}m â”‚   {metrics['trend']}   â”‚ {bar} â”‚"

    report += """
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Performance Score: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 82/100

<details>
<summary>ğŸ” Detailed Metrics</summary>

#### Time Distribution
```
Setup       â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  20%
Build       â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘  60%
Tests       â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  20%
```

#### Optimization Suggestions
- ğŸ¯ Consider caching dependencies (potential 30% improvement)
- ğŸ”§ Parallelize test execution (potential 15% improvement)
- ğŸ“¦ Use incremental builds (potential 20% improvement)

</details>

---
<sub>Generated by ASCII Performance Bot ğŸ¤– | [View Full Report](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})</sub>"""

    print(report)

if __name__ == "__main__":
    main()
